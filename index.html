<!--
youembed.github.io - Single-file GitHub Pages app

How to deploy:
1. Create a GitHub repo named YOURUSERNAME.github.io (replace YOURUSERNAME).
2. Add this file as index.html in the repository root and commit / push.
3. GitHub Pages will serve it at https://YOURUSERNAME.github.io

Usage examples:
https://YOURUSERNAME.github.io/kh1RqsJzUXI?list=PLQ9iZFHOkIuJcaPS805Zn14Szh5jwh5zy&t=99
https://YOURUSERNAME.github.io/?v=kh1RqsJzUXI&t=1m39s&autoplay=1

This page takes the path (first segment after "/") as the YouTube video ID if present.
It also accepts query parameters (list, t, autoplay, rel, controls, etc.).
Parameter "t" supports formats like "99", "1m39s", "1:39" or "1h2m3s" and will be translated to the embed's "start" parameter.

-->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>YouEmbed — Simple YouTube embed shortcut</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa4b2;--accent:#ff6b6b}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071027 0%,#07101a 100%);color:#e6eef6;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Apple Color Emoji,sans-serif}
    .wrap{max-width:1100px;margin:36px auto;padding:20px}
    .card{background:rgba(255,255,255,0.02);border-radius:12px;padding:18px;box-shadow:0 6px 30px rgba(2,6,23,0.6)}
    h1{margin:0 0 8px;font-size:20px}
    p.lead{margin:0;color:var(--muted)}
    .player{position:relative;padding-top:56.25%;margin-top:18px;border-radius:10px;overflow:hidden;background:#000}
    iframe{position:absolute;left:0;top:0;width:100%;height:100%;border:0}
    .meta{margin-top:14px;display:flex;gap:10px;flex-wrap:wrap}
    .input{display:flex;gap:8px}
    input[type=text]{flex:1;padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    button{padding:8px 12px;border-radius:8px;border:0;background:var(--accent);color:#081022;font-weight:600}
    .small{font-size:13px;color:var(--muted)}
    .share{display:flex;gap:8px;align-items:center}
    a.link{color:#a9d2ff;text-decoration:none}
    footer{margin-top:22px;color:var(--muted);font-size:13px}
    .notice{margin-top:10px;padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>YouEmbed</h1>
      <p class="lead">Use <code>https://yourusername.github.io/VIDEO_ID?params</code> to embed YouTube videos quickly. This page converts the path+query into a proper YouTube embed (handles timestamps).</p>

      <div id="app">
        <div class="input">
          <input id="urlInput" type="text" placeholder="Paste a full YouTube URL or just the video ID (e.g. kh1RqsJzUXI)" />
          <button id="goBtn">Load</button>
        </div>

        <div id="playerContainer" style="display:none">
          <div class="player" id="player"></div>
          <div class="meta">
            <div class="share small">Shareable URL: <a id="shareLink" class="link" href="#" target="_blank"></a></div>
            <div class="small"> | </div>
            <div class="small">Embed URL: <a id="embedLink" class="link" href="#" target="_blank"></a></div>
            <div style="margin-left:auto"><button id="copyBtn">Copy page URL</button></div>
          </div>
          <div class="notice small">If you enable <code>loop=1</code> this script will add a <code>playlist=VIDEO_ID</code> parameter (a YouTube requirement for loop to work).</div>
        </div>

        <div id="emptyState" style="margin-top:16px">
          <p class="small">If you open the root URL without a video id you'll get this page. Drop a video ID in the box above or click the "Load" button to generate an embed.</p>
        </div>
      </div>

      <footer>
        Built for quick GitHub Pages embedding • Preserves playlist & timestamp parameters • Converts t -> start
      </footer>
    </div>
  </div>

  <script>
    // Helpers
    function parseTimestampToSeconds(t){
      if(t==null) return null;
      t = String(t).trim();
      if(!t) return null;

      // numeric seconds
      if(/^\d+$/.test(t)) return parseInt(t,10);

      // formats like 1:23 or 01:02:03
      if(/^\d{1,2}(:\d{1,2})+$/.test(t)){
        const parts = t.split(':').map(Number);
        let s = 0; for(let i=0;i<parts.length;i++){ s = s*60 + parts[i]; } // handles hh:mm:ss
        return s;
      }

      // formats like 1h2m3s or 2m30s or 90s
      const re = /(?:(\d+)h)?(?:(\d+)m)?(?:(\d+)s)?$/i;
      const m = t.match(re);
      if(m){
        const h = parseInt(m[1]||0,10);
        const mm = parseInt(m[2]||0,10);
        const s = parseInt(m[3]||0,10);
        const total = h*3600 + mm*60 + s;
        if(total>0) return total;
      }

      // fallback try to extract digits
      const digits = t.match(/\d+/);
      return digits?parseInt(digits[0],10):null;
    }

    function extractVideoIdFromString(s){
      if(!s) return null;
      s = s.trim();
      // If it's already an id (11 chars or longer for modern ids)
      if(/^[A-Za-z0-9_-]{8,}$/.test(s) && !s.includes('http')) return s;

      // youtube watch?v= or v= param
      try{
        const url = new URL(s.startsWith('http')?s:'https://'+s);
        // youtu.be/ID
        if(url.hostname.includes('youtu.be')){
          const id = url.pathname.replace(/^\//,'');
          if(id) return id;
        }
        // youtube.com/watch?v=ID
        if(url.searchParams.has('v')) return url.searchParams.get('v');
        // sometimes path like /embed/ID
        const m = url.pathname.match(/\/([A-Za-z0-9_-]{8,})/);
        if(m) return m[1];
      }catch(e){ /* ignore */ }
      return null;
    }

    function buildEmbedUrl(videoId, originalParams, hashParams){
      const params = new URLSearchParams();

      // copy original query params but convert t -> start
      for(const [k,v] of originalParams.entries()){
        if(k==='v') continue; // don't forward v
        if(k==='t'){
          const secs = parseTimestampToSeconds(v);
          if(secs!=null) params.set('start', String(secs));
          continue;
        }
        params.set(k,v);
      }

      // also check hash params for a t= or start= (e.g. #t=1m39s)
      if(hashParams){
        if(hashParams.t && !params.has('start')){
          const secs = parseTimestampToSeconds(hashParams.t);
          if(secs!=null) params.set('start', String(secs));
        }
        if(hashParams.start && !params.has('start')){
          const s = parseInt(hashParams.start,10);
          if(!Number.isNaN(s)) params.set('start', String(s));
        }
      }

      // If loop=1 and no playlist param, add playlist=VIDEOID (YouTube requirement for loop)
      if(params.get('loop')==='1' && !params.has('playlist')){
        params.set('playlist', videoId);
      }

      const q = params.toString();
      return 'https://www.youtube.com/embed/' + encodeURIComponent(videoId) + (q?('?'+q):'');
    }

    // parse hash like #t=1m30s&foo=bar
    function parseHashParams(){
      if(!location.hash) return {};
      const h = location.hash.replace(/^#/,'');
      const sp = new URLSearchParams(h);
      const obj = {};
      for(const [k,v] of sp.entries()) obj[k]=v;
      return obj;
    }

    // init
    (function(){
      const urlParams = new URLSearchParams(location.search);
      const hashParams = parseHashParams();
      const path = location.pathname.replace(/^\//,'').replace(/\/$/,'');
      let videoId = path || urlParams.get('v') || null;

      const input = document.getElementById('urlInput');
      const goBtn = document.getElementById('goBtn');
      const playerContainer = document.getElementById('playerContainer');
      const player = document.getElementById('player');
      const shareLink = document.getElementById('shareLink');
      const embedLink = document.getElementById('embedLink');
      const copyBtn = document.getElementById('copyBtn');

      // If path is empty but the user has a query param v, show that as well on load
      if(videoId){
        // attempt to extract if someone pasted full URL into path (rare)
        const maybe = extractVideoIdFromString(videoId);
        if(maybe) videoId = maybe;
        renderForVideo(videoId, urlParams, hashParams);
      }

      goBtn.addEventListener('click', ()=>{
        const text = input.value.trim();
        const vid = extractVideoIdFromString(text);
        if(!vid){ alert('Could not parse a video ID from that string. Try a raw video ID (e.g. kh1RqsJzUXI) or a full YouTube URL.'); return; }
        // Build a friendly URL for the user and update history
        const newUrl = location.origin + location.pathname.replace(/\/[^/]*$/,'/') + vid + location.search + location.hash;
        history.replaceState({},'', '/' + vid + location.search + location.hash);
        renderForVideo(vid, new URLSearchParams(location.search), parseHashParams());
      });

      copyBtn.addEventListener('click', ()=>{
        const url = location.href;
        navigator.clipboard.writeText(url).then(()=>{ copyBtn.textContent='Copied!'; setTimeout(()=>copyBtn.textContent='Copy page URL',1200); }).catch(()=>{ alert('Copy failed — please copy manually: '+url); });
      });

      function renderForVideo(vid, params, hparams){
        if(!vid) return;
        playerContainer.style.display='block';
        document.getElementById('emptyState').style.display='none';
        const embedUrl = buildEmbedUrl(vid, params, hparams);
        player.innerHTML = '<iframe src="'+embedUrl+'" title="YouTube video player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>';

        // share and embed links
        const pageUrl = location.origin + '/' + vid + (location.search||'') + (location.hash||'');
        shareLink.href = pageUrl; shareLink.textContent = pageUrl;
        embedLink.href = embedUrl; embedLink.textContent = embedUrl;
      }

      // also allow pressing Enter in the input field
      input.addEventListener('keydown', (e)=>{ if(e.key==='Enter') goBtn.click(); });

      // Prepopulate input with path or v param
      if(videoId) input.value = videoId;

    })();
  </script>
</body>
</html>